{% if close %}<script type="text/javascript">{% if action == 'Popup' %}window.close();{% else %}history.go(-2);{% endif %}</script>
{% elseif noID %}
{{module.editFinish(action, 'Sorry, no ID was selected!')}}
{% else %}
<script type="text/javascript">
function toggleMethod(sOption)
{
  userDiv = document.getElementById('user');
  keyDiv = document.getElementById('key');
  levelDiv = document.getElementById('level');

  if (sOption == 'unassigned')
  {
    userDiv.style.display = keyDiv.style.display = levelDiv.style.display = 'none';
  }

  if (sOption == 'leasttickets' || sOption == 'roundrobin')
  {
    userDiv.style.display = 'none';
    keyDiv.style.display = levelDiv.style.display = 'block';
  }

  if (sOption == 'direct')
  {
    userDiv.style.display = 'block';
    keyDiv.style.display = levelDiv.style.display = 'none';
  }

  return false;
}
</script>
<form name="Edit" action="{{module.generateUri(currentItem.id, method)}}" method="post">
<div class="field"><span class="label">Name</span><span class="data"><input type="text" name="{{module.type}}[Name]" id="{{module.type}}[Name]" value="{{currentItem.Name | title | e}}"></span></div>
<div class="field">
  <span class="label">Assignment Method</span>
  <span class="data">
    <select name="{{module.type}}[AssignmentMethod]" id="{{module.type}}AssignmentMethod" onchange="toggleMethod(this.value);">
{% for assignmentMethod in currentItem.AssignmentMethodList %}      <option value="{{assignmentMethod}}"{% if assignmentMethod == currentItem.AssignmentMethod %} selected="selected"{% endif %}>{{assignmentMethod | title}}</option>
{% endfor %}    </select>
  </span>
</div>
<div id="user" class="field" style="display: none;">
  <span class="label">User</span>
  <span class="data">
    <select name="{{module.type}}[UserID]" id="{{module.tyoe}}UserID">
      <option value="">Select a user</option>
{% for user in currentItem.search('User', {'Active': true, 'Visible': true}) %}      <option value="{{user.id}}"{% if user.id == currentItem.userID %} selected="selected"{% endif %}>{{user.name | title | e}}</option>
{% endfor %}
    </select>
  </span>
</div>
<div id="key" class="field" style="display: none;">
  <span class="label">Required resource</span>
  <span class="data">
    <select name="{{module.type}}[KeyID]" id="{{module.type}}KeyID">
      <option value="">None</option>
{% for key in currentItem.search('ResourceKey') %}      <option value="{{key.id}}"{% if key.id == currentItem.keyID %} selected="selected"{% endif %}>{{key.name | title |e}}</option>
{% endfor %}
    </select>
  </span>
</div>
<div id="level" class="field" style="display: none;">
  <span class="label">Level</span><span class="data"><input type="text" name="{{module.type}}[Level]" id="{{module.type}}[Level]" value="{{currentItem.level}}"></span>
</div>
<div class="field"><span class="blankLabel"></span><span class="data"><input type="submit" name="Update" value="Update">&nbsp;&nbsp;&nbsp;&nbsp;<input type="submit" name="No" value="No" onClick="history.go(-1)"></span></div>
</form>
<script type="text/javascript">toggleMethod('{{currentItem.assignmentMethod}}');</script>
{% endif %}